<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Schedule</title>
	<link rel="stylesheet" href="schedule.css">
</head>

<body>
	<div id='content'>
		<div id='default'>
			<p id='day'></p>
			<table id='periods'>

			</table>
			<p id='countdown'></p>
			<p id='next'></p>
			<p id='optionsButton'>Show options</p>
		</div>
		<div id='options' style='display: none;'>
			<div class="dark" id="days">

				<label>
					<input type="radio" name="days" value="0">
					<span class="design"></span>
					<span class="text">Long All</span>
				</label>

				<label>
					<input type="radio" name="days" value="1">
					<span class="design"></span>
					<span class="text">Even/Odd Block</span>
				</label>

				<!-- <label>
					<input type="radio" name="days" value="2">
					<span class="design"></span>
					<span class="text">Rally</span>
				</label>

				<label>
					<input type="radio" name="days" value="3">
					<span class="design"></span>
					<span class="text">Assembly</span>
				</label> -->

			</div>
			<div class="dark" id="polarity">

				<label>
					<input type="radio" name="polar" value="0">
					<span class="design"></span>
					<span class="text">Even</span>
				</label>

				<label>
					<input type="radio" name="polar" value="1">
					<span class="design"></span>
					<span class="text">Odd</span>
				</label>

			</div><br>

		</div>
	</div>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		const schedule = [{
				dayID: '0',
				dayName: 'Sunday',
				schedule: 0,
				polarity: 0
			},
			{
				dayID: '1',
				dayName: 'Monday',
				schedule: 0,
				polarity: 0
			},
			{
				dayID: '2',
				dayName: 'Tuesday',
				schedule: 1,
				polarity: 0
			},
			{
				dayID: '3',
				dayName: 'Wednesday',
				schedule: 1,
				polarity: 0
			},
			{
				dayID: '4',
				dayName: 'Thursday',
				schedule: 1,
				polarity: 1
			},
			{
				dayID: '5',
				dayName: 'Friday',
				schedule: 1,
				polarity: 1
			},
			{
				dayID: '6',
				dayName: 'Saturday',
				schedule: 0,
				polarity: 0
			}
		]

		var blocks = [
			[
				[{
						name: '1',
						start: '8:00',
						end: '8:35'
					},
					{
						name: '2',
						start: '8:40',
						end: '9:20'
					},
					{
						name: '3',
						start: '9:25',
						end: '10:15'
					},
					{
						name: '4',
						start: '10:35',
						end: '11:15'
					},
					{
						name: '5',
						start: '11:20',
						end: '12:00'
					},
					{
						name: 'Lunch',
						start: '12:00',
						end: '12:35'
					},
					{
						name: '6',
						start: '12:35',
						end: '13:15'
					},
					{
						name: '7',
						start: '13:20',
						end: '14:00'
					}
				],
				[{
						name: '1',
						start: '8:00',
						end: '8:40'
					},
					{
						name: '2',
						start: '8:45',
						end: '10:00'
					},
					{
						name: '4',
						start: '10:10',
						end: '11:25'
					},
					{
						name: '6',
						start: '11:35',
						end: '12:50'
					}
				],
				[{
						name: '1',
						start: '7:40',
						end: '8:30'
					},
					{
						name: '2',
						start: '8:35',
						end: '10:10'
					},
					{
						name: 'Rally',
						start: '10:15',
						end: '10:50'
					},
					{
						name: 'Break',
						start: '10:50',
						end: '11:00'
					},
					{
						name: '4',
						start: '11:05',
						end: '12:45'
					},
					{
						name: 'Lunch',
						start: '12:45',
						end: '13:15'
					},
					{
						name: '6',
						start: '13:20',
						end: '15:00'
					}
				],
				[{
						name: '1',
						start: '7:40',
						end: '8:30'
					},
					{
						name: '2',
						start: '8:35',
						end: '10:00'
					},
					{
						name: 'Assembly',
						start: '10:05',
						end: '11:05'
					},
					{
						name: 'Break',
						start: '11:05',
						end: '11:15'
					},
					{
						name: '4',
						start: '11:20',
						end: '12:50'
					},
					{
						name: 'Lunch',
						start: '12:50',
						end: '13:25'
					},
					{
						name: '6',
						start: '13:30',
						end: '15:00'
					}
				]
			],
			[
				[{
						name: '1',
						start: '8:00',
						end: '8:35'
					},
					{
						name: '2',
						start: '8:40',
						end: '9:20'
					},
					{
						name: '3',
						start: '9:25',
						end: '10:15'
					},
					{
						name: '4',
						start: '10:35',
						end: '11:15'
					},
					{
						name: '5',
						start: '11:20',
						end: '12:00'
					},
					{
						name: 'Lunch',
						start: '12:00',
						end: '12:35'
					},
					{
						name: '6',
						start: '12:35',
						end: '13:15'
					},
					{
						name: '7',
						start: '13:20',
						end: '14:00'
					}
				],
				[{
						name: '1',
						start: '8:00',
						end: '8:40'
					},
					{
						name: '3',
						start: '8:45',
						end: '10:00'
					},
					{
						name: '5',
						start: '10:10',
						end: '11:25'
					},
					{
						name: '7',
						start: '11:35',
						end: '12:50'
					}
				],
				[{
						name: '1',
						start: '7:40',
						end: '8:30'
					},
					{
						name: '3',
						start: '8:35',
						end: '10:10'
					},
					{
						name: 'Rally',
						start: '10:15',
						end: '10:50'
					},
					{
						name: 'Break',
						start: '10:50',
						end: '11:00'
					},
					{
						name: '5',
						start: '11:05',
						end: '12:45'
					},
					{
						name: 'Lunch',
						start: '12:45',
						end: '13:15'
					},
					{
						name: '7',
						start: '13:20',
						end: '15:00'
					}
				],
				[{
						name: '1',
						start: '7:40',
						end: '8:30'
					},
					{
						name: '3',
						start: '8:35',
						end: '10:00'
					},
					{
						name: 'Assembly',
						start: '10:05',
						end: '11:05'
					},
					{
						name: 'Break',
						start: '11:05',
						end: '11:15'
					},
					{
						name: '5',
						start: '11:20',
						end: '12:50'
					},
					{
						name: 'Lunch',
						start: '12:50',
						end: '13:25'
					},
					{
						name: '7',
						start: '13:30',
						end: '15:00'
					}
				]
			]
		];

		var timesMS = [];
		var periods;
		var countdownM = 0;
		var countdownS = 0;

		var d = new Date();
		var weekday = new Array(7);
		weekday[0] = "Sunday";
		weekday[1] = "Monday";
		weekday[2] = "Tuesday";
		weekday[3] = "Wednesday";
		weekday[4] = "Thursday";
		weekday[5] = "Friday";
		weekday[6] = "Saturday";

		var curDay = d.getDay();
		var n = weekday[curDay];
		var block = schedule[curDay].schedule;
		var polarity = schedule[curDay].polarity;

		function processSchedule() {
			periods = blocks[polarity][block];
			$('#periods').html('<tr><th>Period</th><th>Start/End</th><th>Duration</th></tr>');
			timesMS = [];
			for (var i = 0; i < periods.length; i++) {
				p = periods[i];

				var sHr = p.start.split(':')[0]
				var sMin = p.start.split(':')[1]
				var eHr = p.end.split(':')[0]
				var eMin = p.end.split(':')[1]

				var sTime = new Date(d.toString());
				var eTime = new Date(d.toString());

				sTime.setHours(sHr);
				sTime.setMinutes(sMin);
				sTime.setSeconds(0);
				sTime.setMilliseconds(0);
				eTime.setHours(eHr);
				eTime.setMinutes(eMin);
				eTime.setSeconds(0);
				eTime.setMilliseconds(0);

				var duration = (eTime.getTime() - sTime.getTime()) / 60000
				$('#periods').append(
					$('<tr>').append(
						$('<td>').text(p.name)
					).append(
						$('<td>').text(p.start + ' - ' + p.end)
					).append(
						$('<td>').text(duration)
					)
				)

				timesMS.push(sTime.getTime());
				timesMS.push(eTime.getTime());
			}
		}

		if (curDay == 0 || curDay == 6) {
			$('#day').text(`No school today, it be ${n}.`);
			$('#polarity').hide();
		} else {
			$('#day').text(n);
			processSchedule();
			if (block == 0) {
				$('#polarity').hide();
			}
			$(`input[name=days][value=${block}]`).attr('checked', 'checked');
			// $(`input[name=polarity][value=${polarity}]`).attr('checked', 'checked');

			function yee() {
				var se;
				var current = new Date();
				if (current.getDay() != d.getDay()) {
					location.reload
				}
				currentMS = current.getTime()
				for (var i = 0; i <= timesMS.length; i++) {
					if (currentMS < timesMS[i]) {
						countdownM = Math.abs(Math.floor((timesMS[i] - currentMS) / 60000))
						countdownS = ((timesMS[i] - currentMS) % 60000) / 1000;
						next = periods[Math.floor(i / 2)].name;
						if (!isNaN(next)) {
							next = "period " + next;
						}
						if (i % 2 == 0) {
							se = 'Starts'
						} else {
							se = 'Ends'
						}
						break
					}
				}
				$('#countdown').text(countdownM + ':' + countdownS);
				$('#next').text('Until ' + next + ' ' + se);
			}

			setInterval(yee, 1)
			setInterval(function() {
				document.title = countdownM + ':' + Math.floor(countdownS)
			}, 1000)
		}

		$('input[type=radio][name=days]').change(function() {
			block = $(this).val();
			console.log(block);
			if (block == 0) {
				$('#polarity').hide();
			} else {
				$('#polarity').show();
			}
			processSchedule();
		});

		$('input[type=radio][name=polar]').change(function() {
			console.log($(this).val());
			polarity = $(this).val();
			processSchedule();
		});

		$('#optionsButton').click(function() {
			$(this).text($(this).text().includes("Show") ? "Hide options" : "Show options");
			$('#options').fadeToggle(700);
		})
	</script>


	<body>

</html>
